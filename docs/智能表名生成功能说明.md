# 智能表名生成功能说明

## 🎯 功能概述

DataProxy的智能表名生成功能采用多层级策略，能够智能地为不同银行机构和命名规范的数据文件生成标准化的数据库表名。

## 🔄 四层级生成策略

### 1. 配置文件映射（优先级最高）
- **精确匹配**: 完全匹配文件名
- **模式匹配**: 基于关键词匹配
- **机构特定**: 支持不同银行机构的命名规范

### 2. LLM智能推断
- 使用DeepSeek API智能分析文件名
- 理解业务含义并生成合适的表名
- 支持中英文混合文件名

### 3. 模式匹配（向后兼容）
- 基于预定义的业务关键词
- 支持银行业务常见术语
- 保持与现有系统的兼容性

### 4. 回退方案
- 通用命名规则
- 字符清理和标准化
- 确保生成有效的表名

## 📁 配置文件结构

### 位置
```
configs/table_name_mappings.json
```

### 配置示例
```json
{
  "exact_matches": {
    "CONT_RACTCLASSIFY合同五级分类表": "contract_classification",
    "客户基本信息表": "customer_basic_info"
  },
  "pattern_matches": {
    "存款": "deposit_balance",
    "贷款": "loan_info",
    "客户": "customer_info"
  },
  "institution_specific": {
    "工商银行": {
      "ICBC_DEPOSIT_": "icbc_deposit_"
    }
  }
}
```

## 🧪 测试结果示例

### ✅ 成功案例
| 输入文件名 | 生成表名 | 策略 |
|-----------|---------|------|
| `CONT_RACTCLASSIFY合同五级分类表.xlsx` | `contract_classification` | 配置映射 |
| `客户基本信息表.xlsx` | `customer_basic_info` | 配置映射 |
| `ICBC_DEPOSIT_BALANCE_202401.xlsx` | `deposit_info` | 模式匹配 |
| `新银行存款数据表.xlsx` | `deposit_balance` | 模式匹配 |
| `Report_Customer_Analysis_V2.1.xlsx` | `customer_info` | 模式匹配 |

### ⚠️ 需要注意的案例
| 输入文件名 | 生成表名 | 问题 | 解决方案 |
|-----------|---------|------|----------|
| `123数据表.xlsx` | `123` | 数字开头无效 | 添加前缀或使用配置映射 |
| `特殊符号@#$%数据表.xlsx` | `data_table` | 特殊字符处理 | 自动清理为通用名称 |

## 🔧 自定义配置

### 添加新的精确匹配
```json
{
  "exact_matches": {
    "您的文件名": "your_table_name"
  }
}
```

### 添加新的模式匹配
```json
{
  "pattern_matches": {
    "关键词": "table_name"
  }
}
```

### 机构特定配置
```json
{
  "institution_specific": {
    "您的银行": {
      "文件前缀_": "表名前缀_"
    }
  }
}
```

## 📊 支持的银行业务术语

### 存款业务
- 存款、deposit、余额、balance
- 对公存款、企业存款、个人存款

### 贷款业务  
- 贷款、loan、放款、lending
- 合同、contract、协议

### 客户管理
- 客户、customer、用户、user
- 基本信息、详细信息、档案

### 交易处理
- 交易、transaction、流水、flow
- 明细、detail、记录、record

### 风险管理
- 风险、risk、评级、rating
- 分类、classification、等级

## 🚀 使用方法

### 1. 直接使用CLI命令
```bash
python3 dataproxy_cli.py import-with-context --output my_database.db
```

### 2. 自定义配置文件
1. 编辑 `configs/table_name_mappings.json`
2. 添加您的文件名映射规则
3. 重新运行导入命令

### 3. 验证生成结果
```bash
python3 test_smart_table_names.py
```

## 🔍 故障排除

### 问题1: 表名不符合预期
**解决方案**: 在配置文件中添加精确匹配规则

### 问题2: 特殊字符导致无效表名
**解决方案**: 系统会自动清理特殊字符，或使用配置映射

### 问题3: 数字开头的表名无效
**解决方案**: 在配置文件中为此类文件添加映射规则

## 📈 最佳实践

1. **优先使用配置映射**: 为常用文件添加精确匹配规则
2. **定期更新配置**: 根据新的文件类型更新映射规则
3. **测试验证**: 使用测试脚本验证新配置的效果
4. **文档记录**: 为团队维护配置文件的说明文档

## 🎯 未来扩展

- 支持更多银行机构的命名规范
- 增强LLM推断能力
- 添加表名冲突检测和解决
- 支持自定义命名模板

---

**注意**: 此功能完全向后兼容，现有的测试文件将继续正常工作。
