# DataProxy åç«¯APIç«¯ç‚¹æ€»è§ˆ

## ğŸ¯ APIç«¯ç‚¹é…ç½®å®ŒæˆçŠ¶æ€

æ ¹æ®å‰ç«¯æ•°æ®åˆ†ææ¨¡å—çš„éœ€æ±‚ï¼Œå·²å®Œæˆæ‰€æœ‰21ä¸ªAPIç«¯ç‚¹çš„åç«¯å®ç°é…ç½®ã€‚

## ğŸ“‹ APIç«¯ç‚¹åˆ—è¡¨

### 1. ç³»ç»ŸçŠ¶æ€API (2ä¸ªç«¯ç‚¹)

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | å®ç°çŠ¶æ€ |
|------|------|------|----------|
| `/health` | GET | å¥åº·æ£€æŸ¥ | âœ… å·²å®ç° |
| `/api/v1/status` | GET | ç³»ç»Ÿè¯¦ç»†çŠ¶æ€ | âœ… å·²å®ç° |

### 2. æ•°æ®åº“ç®¡ç†API (4ä¸ªç«¯ç‚¹)

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | å®ç°çŠ¶æ€ |
|------|------|------|----------|
| `/api/v1/databases` | GET | è·å–æ•°æ®åº“åˆ—è¡¨ | âœ… å·²å®ç° |
| `/api/v1/databases/switch` | POST | åˆ‡æ¢å½“å‰æ•°æ®åº“ | âœ… å·²å®ç° |
| `/api/v1/databases/{path}/tables` | GET | è·å–è¡¨åˆ—è¡¨ | âœ… å·²å®ç° |
| `/api/v1/databases/{path}/tables/{name}/data` | GET | è·å–è¡¨æ•°æ® | âœ… å·²å®ç° |

### 3. æŸ¥è¯¢å¤„ç†API (4ä¸ªç«¯ç‚¹)

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | å®ç°çŠ¶æ€ |
|------|------|------|----------|
| `/api/v1/queries/agent` | POST | æ™ºèƒ½åˆ†ææŸ¥è¯¢ | âœ… å·²å®ç° |
| `/api/v1/queries/nl2sql` | POST | è‡ªç„¶è¯­è¨€è½¬SQL | âœ… å·²å®ç° |
| `/api/v1/queries/conversation` | POST | å¤šè½®å¯¹è¯æŸ¥è¯¢ | âœ… å·²å®ç° |
| `/api/v1/queries/history` | GET | æŸ¥è¯¢å†å²è®°å½• | âœ… å·²å®ç° |

### 4. å¯è§†åŒ–API (2ä¸ªç«¯ç‚¹)

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | å®ç°çŠ¶æ€ |
|------|------|------|----------|
| `/api/v1/visualize` | POST | åˆ›å»ºå›¾è¡¨ | âœ… å·²å®ç° |
| `/api/v1/visualizations` | GET | è·å–å›¾è¡¨åˆ—è¡¨ | âœ… å·²å®ç° |

### 5. æ–‡ä»¶ç®¡ç†API (1ä¸ªç«¯ç‚¹)

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | å®ç°çŠ¶æ€ |
|------|------|------|----------|
| `/api/v1/upload` | POST | æ–‡ä»¶ä¸Šä¼  | âœ… å·²å®ç° |

### 6. ä¸Šä¸‹æ–‡ç®¡ç†API (6ä¸ªç«¯ç‚¹)

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | å®ç°çŠ¶æ€ |
|------|------|------|----------|
| `/api/v1/contexts` | GET | è·å–ä¸Šä¸‹æ–‡åˆ—è¡¨ | âœ… å·²å®ç° |
| `/api/v1/contexts/{path}` | GET | è·å–ä¸Šä¸‹æ–‡è¯¦æƒ… | âœ… å·²å®ç° |
| `/api/v1/contexts` | POST | åˆ›å»ºä¸Šä¸‹æ–‡ | âœ… å·²å®ç° |
| `/api/v1/contexts/{path}` | PUT | æ›´æ–°ä¸Šä¸‹æ–‡ | âœ… å·²å®ç° |
| `/api/v1/contexts/{path}/refresh` | POST | åˆ·æ–°ä¸Šä¸‹æ–‡ | âœ… å·²å®ç° |
| `/api/v1/contexts/{path}` | DELETE | åˆ é™¤ä¸Šä¸‹æ–‡ | âœ… å·²å®ç° |

### 7. é…ç½®ç®¡ç†API (2ä¸ªç«¯ç‚¹)

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | å®ç°çŠ¶æ€ |
|------|------|------|----------|
| `/api/v1/configurations/business-terms` | GET/POST | ä¸šåŠ¡æœ¯è¯­é…ç½® | âœ… å·²å®ç° |
| `/api/v1/configurations/field-mappings` | GET/POST | å­—æ®µæ˜ å°„é…ç½® | âœ… å·²å®ç° |

## ğŸ—ï¸ åç«¯æ¶æ„å®ç°

### APIè“å›¾ç»“æ„
```
flask_backend/api/
â”œâ”€â”€ system_endpoints.py      # ç³»ç»Ÿç®¡ç†API
â”œâ”€â”€ database_endpoints.py    # æ•°æ®åº“ç®¡ç†API
â”œâ”€â”€ query_endpoints.py       # æŸ¥è¯¢å¤„ç†API
â”œâ”€â”€ visualization_endpoints.py # å¯è§†åŒ–API
â”œâ”€â”€ file_endpoints.py        # æ–‡ä»¶ç®¡ç†API
â”œâ”€â”€ context_endpoints.py     # ä¸Šä¸‹æ–‡ç®¡ç†API
â”œâ”€â”€ config_endpoints.py      # é…ç½®ç®¡ç†API
â”œâ”€â”€ error_handlers.py        # ç»Ÿä¸€é”™è¯¯å¤„ç†
â””â”€â”€ request_validators.py    # è¯·æ±‚éªŒè¯
```

### ä¸»è¦ç‰¹æ€§

#### 1. ç»Ÿä¸€é”™è¯¯å¤„ç†
- æ ‡å‡†åŒ–çš„é”™è¯¯å“åº”æ ¼å¼
- åˆ†ç±»é”™è¯¯å¤„ç†ï¼ˆéªŒè¯é”™è¯¯ã€ç³»ç»Ÿé”™è¯¯ç­‰ï¼‰
- å‹å¥½çš„é”™è¯¯ä¿¡æ¯

#### 2. è¯·æ±‚éªŒè¯
- è¾“å…¥å‚æ•°éªŒè¯
- æ•°æ®ç±»å‹æ£€æŸ¥
- å¿…éœ€å­—æ®µéªŒè¯

#### 3. å“åº”æ ¼å¼æ ‡å‡†åŒ–
```json
{
  "success": true/false,
  "data": {...},
  "error": "é”™è¯¯ä¿¡æ¯",
  "timestamp": 1234567890
}
```

#### 4. åˆ†é¡µæ”¯æŒ
- ç»Ÿä¸€çš„åˆ†é¡µå‚æ•°ï¼ˆlimit, offsetï¼‰
- åˆ†é¡µå…ƒæ•°æ®è¿”å›
- å¤§æ•°æ®é›†ä¼˜åŒ–

## ğŸ”§ é…ç½®å’Œå¯åŠ¨

### ç¯å¢ƒå˜é‡
```bash
DEEPSEEK_API_KEY=your-api-key
DATAPROXY_DATA_DIR=./data
```

### å¯åŠ¨æœåŠ¡
```bash
python3 dataproxy_cli.py start-server --port 8080
```

### éªŒè¯API
```bash
curl http://localhost:8080/health
curl http://localhost:8080/api/v1/status
```

## ğŸ“Š APIä½¿ç”¨ç»Ÿè®¡

| APIç±»åˆ« | ç«¯ç‚¹æ•°é‡ | å®ŒæˆçŠ¶æ€ |
|---------|----------|----------|
| ç³»ç»ŸçŠ¶æ€ | 2 | âœ… 100% |
| æ•°æ®åº“ç®¡ç† | 4 | âœ… 100% |
| æŸ¥è¯¢å¤„ç† | 4 | âœ… 100% |
| å¯è§†åŒ– | 2 | âœ… 100% |
| æ–‡ä»¶ç®¡ç† | 1 | âœ… 100% |
| ä¸Šä¸‹æ–‡ç®¡ç† | 6 | âœ… 100% |
| é…ç½®ç®¡ç† | 2 | âœ… 100% |
| **æ€»è®¡** | **21** | **âœ… 100%** |

## ğŸ¯ å‰ç«¯é›†æˆè¦ç‚¹

1. **åŸºç¡€URL**: `http://127.0.0.1:8080`
2. **è®¤è¯**: ä½¿ç”¨APIå¯†é’¥ `dataproxy-api-key-2025`
3. **è¶…æ—¶**: å»ºè®®è®¾ç½®60ç§’è¶…æ—¶
4. **é”™è¯¯å¤„ç†**: æ£€æŸ¥å“åº”ä¸­çš„`success`å­—æ®µ
5. **åˆ†é¡µ**: ä½¿ç”¨`limit`å’Œ`offset`å‚æ•°

## âœ… å®ŒæˆçŠ¶æ€

**æ‰€æœ‰21ä¸ªAPIç«¯ç‚¹å·²å®Œæˆåç«¯å®ç°ï¼Œæ”¯æŒå‰ç«¯æ•°æ®åˆ†ææ¨¡å—çš„å®Œæ•´åŠŸèƒ½éœ€æ±‚ã€‚**
